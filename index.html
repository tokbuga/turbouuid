<!DOCTYPE html>
<html>

<head>
    <script type="module">
        import "./index.js"

        turboUUID.base().then(base => {

            const uuid = turboUUID();
            const value = 2412; //integer

            const setValue = base.setValue(uuid, value);
            const indexOf = base.indexOf(uuid);
            const uuidAt = base.uuidAt(0);
            const has = !!base.has(uuid);
            const count = base.count();
            const valueOf = base.valueOf(uuid);
            const randomUUID = base.randomUUID(value);

            console.warn(base);
            console.log(`const uuid  = \x1b[32m"${uuid}"\x1b[0m`, ";");
            console.log(`const value =`, value, ";");
            console.group(`base calls:`);
            console.log(`base.setValue(\x1b[34m${uuid}, ${value}\x1b[0m)`.padEnd(70).concat("-->"), setValue);
            console.log(`base.indexOf(\x1b[35m${uuid}\x1b[0m)`.padEnd(70).concat("-->"), indexOf);
            console.log(`base.uuidAt(\x1b[36m${indexOf}\x1b[0m)`.padEnd(70).concat("-->"), uuidAt);
            console.log(`base.has(\x1b[33m${uuid}\x1b[0m)`.padEnd(70).concat("-->"), has);
            console.log(`base.count(\x1b[31m\x1b[0m)`.padEnd(70).concat("-->"), count);
            console.log(`base.valueOf(\x1b[31m${uuid}\x1b[0m)`.padEnd(70).concat("-->"), valueOf);
            console.log(`base.randomUUID(\x1b[33m${value}\x1b[0m)`.padEnd(70).concat("-->"), randomUUID);
            console.groupEnd(`base calls:`);

            {
                const map = new Map();
                self.array = new Array();
                let count, uuid, value, t0, t1, t2, dtm, dtb;

                count = 4e3;
                while (count--) {
                    uuid = turboUUID();
                    value = Math.floor(Math.random() * 1e5);

                    if (Math.random() > 0.998) {
                        array.push(uuid);
                    }

                    map.set(uuid, value);
                    base.setValue(uuid, value);
                }

                console.log("ready")
                new BroadcastChannel("uuid").onmessage = e => {
                    const uuid = e.data;

                    t0 = performance.mark("map_start");
                    map.get(uuid);
                    dtm = performance.measure("map", "map_start");
                    performance.clearMarks();
                    performance.clearMeasures();
                    performance.clearResourceTimings();

                    t0 = performance.mark("base_start");
                    base.valueOf(uuid);
                    dtb = performance.measure("base", "base_start");
                    performance.clearMarks();
                    performance.clearMeasures();
                    performance.clearResourceTimings();

                    console.warn({ dtm, dtb })
                }
            }

        })
    </script>
</head>

</html>